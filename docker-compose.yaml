version: '3.8'

services:
  openarc:
    build: .
    image: openarc:latest
    container_name: openarc
    
    # GPU access
    devices:
      - /dev/dri:/dev/dri
    
    # Volumes
    volumes:
      - ${MODEL_PATH:-./models}:/models
      - openarc-config:/persist
    
    # Ports
    ports:
      - "8000:8000"
    
    # Environment variables
    environment:
      - OPENARC_API_KEY=${OPENARC_API_KEY:-openarc-default-key}
      - OPENARC_AUTOLOAD_MODEL=${OPENARC_AUTOLOAD_MODEL:-}
      # Intel GPU tuning variables
      - NEOReadDebugKeys=1
      - OverrideGpuAddressSpace=48
      - EnableImplicitScaling=1
    
    # Restart policy
    restart: unless-stopped
    
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  openarc-config:
